<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Penguin Project</title>
<style>
  :root{
    --panel-w: 320px; --panel-h: 520px;
    --bg: #0f0f0f; --bg2:#1a1a1a; --txt:#eee;
    --muted:#bdbdbd; --accent:#b51212; --accent2:#ff5c5c;
    --row:#ffffff14; --row-hover:#ffffff26; --border:#00000080;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:transparent;font-family:Arial,Helvetica,sans-serif;color:var(--txt)}
  .wrap{padding:14px}
  .panel{
    width:var(--panel-w); height:var(--panel-h);
    display:flex; flex-direction:column; overflow:hidden;
    background:rgba(15,15,15,.92); border-radius:12px;
    box-shadow:0 8px 22px rgba(0,0,0,.55);
    border:1px solid #ffffff12;
  }
  .header{background:linear-gradient(90deg,var(--accent),var(--accent2)); padding:10px 12px; position:relative}
  .brand{margin:0; font-size:18px; font-weight:700; letter-spacing:.3px}
  .crumb{position:absolute; right:10px; bottom:8px; font-size:11px; color:#fff; opacity:.85}
  .tabs{display:flex; background:#222}
  .tab{flex:1; text-align:center; padding:8px 0; font-size:13px; color:#ccc; cursor:pointer; user-select:none; border-right:1px solid #0008}
  .tab:last-child{border-right:none}
  .tab.active{background:var(--accent); color:#fff}
  .body{flex:1; background:var(--bg2); display:flex; flex-direction:column}
  .section{display:none; height:100%}
  .section.active{display:block}
  .groupTitle{padding:10px 12px; font-size:12px; letter-spacing:.3px; color:var(--muted); background:#0003; border-bottom:1px solid #0008}
  .toolbar{padding:8px 10px}
  .select{width:100%; background:#151515; color:#ddd; border:1px solid #ffffff1f; border-radius:6px; padding:8px 10px; font-size:13px}
  .list{height: calc(100% - 92px); overflow:auto; padding:6px 8px}
  .row{display:flex; justify-content:space-between; align-items:center; background:var(--row); padding:8px 10px; border-radius:8px; margin:6px 0; border:1px solid var(--border); transition:.12s background}
  .row:hover{background:var(--row-hover)}
  .row.active{outline:2px solid var(--accent)}
  .name{font-size:13px; color:#f4f4f4}
  .dot{width:10px; height:10px; border-radius:50%; background:#888; box-shadow: inset 0 0 0 2px #0006}
  .footer{display:flex; justify-content:space-between; align-items:center; padding:6px 10px; font-size:12px; background:#111; color:#cfcfcf; border-top:1px solid #0008}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel" id="panel">
      <div class="header">
        <h1 class="brand">Penguin Project</h1>
        <div class="crumb" id="crumb">Home</div>
      </div>

      <div class="tabs" id="tabs">
        <div class="tab active" data-page="home">PlayerList</div>
        <div class="tab" data-page="safe">Safe</div>
        <div class="tab" data-page="vehicle">Vehicle</div>
        <div class="tab" data-page="risky">Risky</div>
      </div>

      <div class="body">
        <!-- HOME -->
        <section class="section active" id="page-home">
          <div class="groupTitle">--- Select Player ---</div>
          <div class="toolbar"><select class="select" id="playerSelect"><option>--- Select Player ---</option></select></div>
          <div class="list" id="playerList"></div>
        </section>

        <!-- SAFE -->
        <section class="section" id="page-safe">
          <div class="groupTitle">Safe</div>
          <div class="list" id="safeList"></div>
        </section>

        <!-- VEHICLE -->
        <section class="section" id="page-vehicle">
          <div class="groupTitle">Vehicle</div>
          <div class="list" id="vehList"></div>
        </section>

        <!-- RISKY -->
        <section class="section" id="page-risky">
          <div class="groupTitle">Risky</div>
          <div class="list" id="riskList"></div>
        </section>
      </div>

      <div class="footer"><div>Beta 1.0 â€¢ Penguin Private</div><div id="pager">0/0</div></div>
    </div>
  </div>

<script>
  // --- state ---
  let players = [];
  let selected = 0; // index in players[]
  const perPage = 9999; // full list (scroll handled by browser)
  const el = {
    tabs:  document.getElementById('tabs'),
    crumb: document.getElementById('crumb'),
    list:  document.getElementById('playerList'),
    select:document.getElementById('playerSelect'),
    pager: document.getElementById('pager'),
    pages: {
      home: document.getElementById('page-home'),
      safe: document.getElementById('page-safe'),
      vehicle: document.getElementById('page-vehicle'),
      risky: document.getElementById('page-risky'),
    }
  };

  // --- renderers ---
  function renderPlayers() {
    // select
    el.select.innerHTML = '<option>--- Select Player ---</option>' +
      players.map(p=>`<option value="${p.id}">${escapeHtml(p.name)} (${p.id})</option>`).join('');

    // list
    el.list.innerHTML = players.map((p,i)=>(
      `<div class="row ${i===selected?'active':''}" data-index="${i}">
         <div class="name">${escapeHtml(p.name)} (${p.id})</div>
         <div class="dot"></div>
       </div>`
    )).join('');

    el.pager.textContent = `${players.length}/${players.length}`;
    // click to select
    el.list.querySelectorAll('.row').forEach(row=>{
      row.addEventListener('click',()=>{
        selected = +row.dataset.index;
        renderPlayers();
      });
    });
  }

  function setTab(page){
    document.querySelector('.tab.active')?.classList.remove('active');
    document.querySelector(`.tab[data-page="${page}"]`)?.classList.add('active');
    document.querySelector('.section.active')?.classList.remove('active');
    el.pages[page].classList.add('active');
    el.crumb.textContent = page[0].toUpperCase()+page.slice(1);
  }

  // --- keyboard ---
  document.addEventListener('keydown', (e)=>{
    if (document.activeElement && ['INPUT','SELECT','TEXTAREA'].includes(document.activeElement.tagName)) return;
    if (e.key==='ArrowDown'){ if (selected < players.length-1){ selected++; renderPlayers(); } }
    if (e.key==='ArrowUp'){ if (selected > 0){ selected--; renderPlayers(); } }
    if (e.key==='1'){ setTab('home'); }
    if (e.key==='2'){ setTab('safe'); }
    if (e.key==='3'){ setTab('vehicle'); }
    if (e.key==='4'){ setTab('risky'); }
    if (e.key==='Enter'){ // no callback to Lua documented; keep highlight only
      // If your Macho exposes a JS->Lua bridge, we can call it here.
      console.log('selected', players[selected]);
    }
  });

  // --- tab clicks ---
  el.tabs.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>setTab(t.dataset.page)));

  // --- message from Lua (MachoSendDuiMessage)
  window.addEventListener('message', (ev)=>{
    const d = ev.data || {};
    if (d.action === 'players' && d.payload && Array.isArray(d.payload.players)) {
      players = d.payload.players;
      // sort by name like the example
      players.sort((a,b)=>a.name.localeCompare(b.name));
      if (selected > players.length-1) selected = Math.max(0, players.length-1);
      renderPlayers();
    }
    if (d.action === 'title' && d.payload && d.payload.text){
      document.querySelector('.brand').textContent = d.payload.text;
    }
  });

  // --- utils ---
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  // initial dummy render
  renderPlayers();
</script>
</body>
</html>
